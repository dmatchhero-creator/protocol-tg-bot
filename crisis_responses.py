#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Модуль автоматических ответов на кризисные ситуации
Содержит шаблоны ответов с ресурсами помощи
"""

from crisis_detector import CrisisType


class CrisisResponses:
    """Генератор ответов на кризисные ситуации"""

    @staticmethod
    def get_response(crisis_type: CrisisType, confidence: float) -> str:
        """
        Возвращает текст ответа в зависимости от типа кризиса

        Args:
            crisis_type: тип кризиса
            confidence: уверенность детекции (0.0-1.0)

        Returns:
            str: текст ответа с рекомендациями и ресурсами
        """
        if crisis_type == CrisisType.PSYCHOSIS:
            return CrisisResponses._psychosis_response()
        elif crisis_type == CrisisType.SUICIDE:
            return CrisisResponses._suicide_response()
        elif crisis_type == CrisisType.PANIC:
            return CrisisResponses._panic_response()
        elif crisis_type == CrisisType.THREATS:
            return CrisisResponses._threats_response()
        else:
            return ""

    @staticmethod
    def _psychosis_response() -> str:
        """Ответ при детекции психоза"""
        return """🚨 <b>ВНИМАНИЕ: ОБНАРУЖЕНЫ ПРИЗНАКИ ПСИХОЗА</b>

<b>ЧТО ПРОИСХОДИТ:</b>
То, что вы описываете (голоса, видения) - признаки психоза. Это медицинское состояние, которое ЛЕЧИТСЯ.

<b>ЭТО НЕ ВАША ВИНА. ЭТО БОЛЕЗНЬ.</b>

━━━━━━━━━━━━━━━━

<b>ЧТО ДЕЛАТЬ ПРЯМО СЕЙЧАС:</b>

1️⃣ <b>ВЫЗОВИТЕ СКОРУЮ:</b>
   🚑 <code>103</code> или <code>112</code>

   Скажите: "У меня голоса в голове и видения. Нужна психиатрическая помощь"

2️⃣ <b>КРИЗИСНЫЕ ЛИНИИ:</b>
   🇷🇺 Россия: <code>8-800-2000-122</code>
   🇷🇺 Москва: <code>8-495-625-31-01</code>
   🇺🇦 Украина: <code>7333</code>

3️⃣ <b>НЕ ОСТАВАЙТЕСЬ ОДНИ:</b>
   Позвоните близкому человеку
   Попросите остаться с вами

━━━━━━━━━━━━━━━━

<b>ПОЧЕМУ ЭТО ВАЖНО:</b>
• Голоса могут стать опасными
• Без лечения состояние ухудшится
• С лекарствами голоса уйдут за 3-7 дней
• Это временное состояние

<b>ЧТО БУДЕТ В БОЛЬНИЦЕ:</b>
✅ Дадут лекарства (антипсихотики)
✅ Голоса исчезнут
✅ Вернётся ясность мышления
✅ Это НЕ тюрьма, это помощь

━━━━━━━━━━━━━━━━

<b>ЕСЛИ НЕ МОЖЕТЕ ДОЙТИ:</b>
Вызовите скорую - они приедут к вам
<code>103</code> или <code>112</code>

⚠️ <b>ЭТО СРОЧНО. НЕ ОТКЛАДЫВАЙТЕ.</b>

Вы в опасности СЕЙЧАС. Действуйте немедленно.

После оказания помощи можете вернуться к нашему боту."""

    @staticmethod
    def _suicide_response() -> str:
        """Ответ при детекции суицидальных мыслей"""
        return """🚨 <b>ВНИМАНИЕ: ОБНАРУЖЕНЫ СУИЦИДАЛЬНЫЕ МЫСЛИ</b>

<b>ВЫ НЕ ОДНИ. ПОМОЩЬ ЕСТЬ.</b>

━━━━━━━━━━━━━━━━

<b>ПОЗВОНИТЕ ПРЯМО СЕЙЧАС:</b>

1️⃣ <b>ТЕЛЕФОН ДОВЕРИЯ (24/7):</b>
   🇷🇺 <code>8-800-2000-122</code> (бесплатно по России)
   🇷🇺 <code>8-495-625-31-01</code> (Москва)
   🇺🇦 <code>7333</code> (кризисная линия)

2️⃣ <b>СКОРАЯ ПОМОЩЬ:</b>
   🚑 <code>103</code> или <code>112</code>

3️⃣ <b>ПСИХОЛОГИЧЕСКАЯ ПОМОЩЬ ОНЛАЙН:</b>
   • https://pomoschryadom.ru (онлайн-чат)
   • https://telefon-doveria.ru

━━━━━━━━━━━━━━━━

<b>ЕСЛИ СЕЙЧАС ОЧЕНЬ ПЛОХО:</b>

🛑 <b>НЕ ОСТАВАЙТЕСЬ ОДНИ</b>
Позвоните кому-то прямо сейчас:
• Другу
• Родственнику
• Соседу
• На телефон доверия

🛑 <b>ОТЛОЖИТЕ РЕШЕНИЯ</b>
Пообещайте себе подождать 24 часа
За это время поговорите с кем-то

🛑 <b>УБЕРИТЕ ОПАСНЫЕ ПРЕДМЕТЫ</b>
Отдайте их кому-то на хранение

━━━━━━━━━━━━━━━━

<b>ПРАВДА:</b>
• Это временное состояние
• Боль уйдёт, если получить помощь
• Тысячи людей прошли через это и живут
• Вы важны

<b>ВЫ СДЕЛАЛИ ПЕРВЫЙ ШАГ - НАПИСАЛИ.</b>
Теперь сделайте второй - позвоните:
<code>8-800-2000-122</code>

⚠️ Там реальные люди, которые помогут.

После стабилизации состояния можете вернуться к нашему боту."""

    @staticmethod
    def _panic_response() -> str:
        """Ответ при детекции панической атаки"""
        return """🚨 <b>ОБНАРУЖЕНА ПАНИЧЕСКАЯ АТАКА / КРАЙНИЙ СТРЕСС</b>

<b>СЕЙЧАС САМОЕ ВАЖНОЕ - ДЫШАТЬ.</b>

━━━━━━━━━━━━━━━━

<b>ЭКСТРЕННАЯ ПОМОЩЬ СЕБЕ (ПРЯМО СЕЙЧАС):</b>

1️⃣ <b>ДЫХАНИЕ 4-7-8:</b>
   • Вдох через нос - 4 секунды
   • Задержка дыхания - 7 секунд
   • Выдох через рот - 8 секунд
   • Повторить 4 раза

2️⃣ <b>ТЕХНИКА ЗАЗЕМЛЕНИЯ "5-4-3-2-1":</b>
   Назовите вслух:
   • 5 вещей, которые ВИДИТЕ
   • 4 вещи, которых КАСАЕТЕСЬ
   • 3 звука, которые СЛЫШИТЕ
   • 2 запаха, которые ЧУВСТВУЕТЕ
   • 1 вкус во рту

3️⃣ <b>ХОЛОДНАЯ ВОДА:</b>
   Умойтесь холодной водой или подержите лёд

━━━━━━━━━━━━━━━━

<b>ЕСЛИ НЕ ПОМОГАЕТ - ЗВОНИТЕ:</b>

📞 <b>КРИЗИСНЫЕ ЛИНИИ (24/7):</b>
   🇷🇺 <code>8-800-2000-122</code>
   🇷🇺 <code>8-495-625-31-01</code> (Москва)
   🇺🇦 <code>7333</code>

🚑 <b>СКОРАЯ ПОМОЩЬ:</b>
   <code>103</code> или <code>112</code>

━━━━━━━━━━━━━━━━

<b>ЧТО ВАЖНО ЗНАТЬ:</b>
✅ Паническая атака НЕ УБИВАЕТ
✅ Это пройдёт (обычно 10-30 минут)
✅ Вы не сходите с ума
✅ Это реакция на стресс

<b>ПОСЛЕ ТОГО КАК УСПОКОИТЕСЬ:</b>
Если приступы повторяются - обратитесь к психотерапевту
Паническое расстройство ЛЕЧИТСЯ

Можете вернуться к нашему боту когда почувствуете себя лучше."""

    @staticmethod
    def _threats_response() -> str:
        """Ответ при детекции угроз жизни"""
        return """🚨 <b>ОБНАРУЖЕНЫ УГРОЗЫ ВАШЕЙ БЕЗОПАСНОСТИ</b>

<b>ВАША ЖИЗНЬ В ПРИОРИТЕТЕ.</b>

━━━━━━━━━━━━━━━━

<b>НЕМЕДЛЕННЫЕ ДЕЙСТВИЯ:</b>

1️⃣ <b>ЕСЛИ УГРОЗА ПРЯМО СЕЙЧАС:</b>
   🚨 Звоните <code>112</code> (полиция)
   🚨 Уходите в безопасное место
   🚨 Не оставайтесь одни

2️⃣ <b>ЗАФИКСИРУЙТЕ УГРОЗЫ:</b>
   • Скриншоты сообщений
   • Записи звонков (если есть)
   • Свидетели

   Это ДОКАЗАТЕЛЬСТВА для полиции

3️⃣ <b>НАПИШИТЕ ЗАЯВЛЕНИЕ В ПОЛИЦИЮ:</b>
   Угрозы жизни = УГОЛОВНОЕ ПРЕСТУПЛЕНИЕ
   • Статья 119 УК РФ (угроза убийством)
   • До 2 лет лишения свободы

   ☎️ Полиция: <code>102</code> или <code>112</code>

━━━━━━━━━━━━━━━━

<b>ЕСЛИ ЭТО КОЛЛЕКТОРЫ ПО ДОЛГАМ:</b>

⚠️ <b>УГРОЗЫ СЕМЬЕ = ПРЕСТУПЛЕНИЕ</b>
Не важно сколько вы должны!

✅ Действия:
• Позвоните на горячую линию ЦБ РФ:
  <code>8-800-250-40-72</code>
• Напишите заявление в полицию
• Зафиксируйте все звонки и сообщения

📄 Угрозы коллекторов:
• Статья 163 УК РФ (вымогательство)
• До 4 лет лишения свободы

━━━━━━━━━━━━━━━━

<b>ЕСЛИ ЭТО СВЯЗАНО С УГОЛОВНЫМ ДЕЛОМ:</b>

🔒 <b>СРОЧНО НУЖЕН АДВОКАТ</b>

• Бесплатная юрпомощь: <code>8-800-250-39-50</code>
• НЕ говорите ничего без адвоката
• Все угрозы фиксируйте и передавайте адвокату

━━━━━━━━━━━━━━━━

<b>КУДА ЗВОНИТЬ:</b>

🚨 <b>ЭКСТРЕННЫЕ СЛУЖБЫ:</b>
   <code>112</code> - единая служба спасения
   <code>102</code> - полиция

📞 <b>ПОМОЩЬ И КОНСУЛЬТАЦИИ:</b>
   <code>8-800-2000-122</code> - психологическая поддержка
   <code>8-800-250-39-50</code> - бесплатная юридическая помощь

━━━━━━━━━━━━━━━━

<b>ГЛАВНОЕ:</b>
• Ваша безопасность важнее долгов
• Угрозы - это преступление
• Вы можете получить защиту
• Не решайте это в одиночку

После обеспечения безопасности можете вернуться к нашему боту."""


# Создаём глобальный экземпляр
crisis_responses = CrisisResponses()


def get_crisis_response(crisis_type: CrisisType, confidence: float) -> str:
    """
    Удобная функция для получения ответа на кризис

    Args:
        crisis_type: тип кризиса
        confidence: уверенность детекции

    Returns:
        str: текст ответа
    """
    return crisis_responses.get_response(crisis_type, confidence)
